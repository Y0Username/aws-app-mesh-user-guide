<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "file://zonbook/docbookx.dtd"
[
    <!ENTITY % xinclude SYSTEM "file://AWSShared/common/xinclude.mod">
    %xinclude;
    <!ENTITY % phrases-shared SYSTEM "file://AWSShared/common/phrases-shared.ent">
    %phrases-shared;
    <!ENTITY % phrases-appmesh SYSTEM "../shared/phrases-app-mesh.ent"> 
    %phrases-appmesh;
]>
<section role="topic" id="virtual_routers">
    <info>
        <title id="virtual_routers.title">Virtual routers</title>
    </info>
    <para>Virtual routers handle traffic for one or more virtual services within your mesh. After
        you create a virtual router, you can create and associate routes for your virtual router
        that direct incoming requests to different virtual nodes.</para>
    <mediaobject>
        <imageobject>
            <imagedata fileref="images/virtual_router.png" format="PNG" width="100%" scalefit="1"
                contentdepth="100%"/>
        </imageobject>
    </mediaobject>
    <para>Any inbound traffic that your virtual router expects should be specified as a
            <emphasis>listener</emphasis>.</para>
    <section id="create-virtual-router">
        <info>
            <title id="create-virtual-router.title">Creating a virtual router</title>
        </info>
        <para>To create a virtual router using the &CLI; version &aws_cli_min_version; or higher,
            see the example in the &CLI; reference for the <ulink type="documentation"
                url="cli/latest/reference/appmesh/create-virtual-router.html"
                >create-virtual-router</ulink> command.</para>
        <procedure>
            <title>To create a virtual router using the &console;</title>
            <note>
                <para>When creating a Virtual Router, you must add a namespace selector with a label
                    to identify the list of namespaces to associate Routes to the created Virtual
                    Router.</para>
            </note>
            <step>
                <para>&MESHConsoleSwitch;</para>
            </step>
            <step>
                <para>Choose the mesh that you want to create the virtual router in. All of the
                    meshes that you own and that have been <link linkend="sharing">shared</link>
                    with you are listed.</para>
            </step>
            <step>
                <para>Choose <guilabel>Virtual routers</guilabel> in the left navigation.</para>
            </step>
            <step>
                <para>Choose <guilabel>Create virtual router</guilabel>.</para>
            </step>
            <step>
                <para>For <guilabel>Virtual router name</guilabel>, specify a name for your virtual
                    router. Up to 255 letters, numbers, hyphens, and underscores are allowed.</para>
            </step>
            <step>
                <para>For <guilabel>Listener</guilabel>, specify a <guilabel>Port</guilabel> and
                        <guilabel>Protocol</guilabel> for your virtual router. The <code>http</code>
                    listener permits connection transition to websockets.</para>
            </step>
            <step>
                <para>Choose <guilabel>Create virtual router</guilabel> to finish.</para>
            </step>
        </procedure>
    </section>
    <section id="delete-virtual-router">
        <info>
            <title id="delete-virtual-router.title">Deleting a virtual router</title>
        </info>
        <para>To delete a virtual router using the &CLI;, use the <code>aws appmesh
                delete-virtual-router</code> command. For an example of deleting a virtual router
            using the &CLI;, see <ulink url="&url-mesh-cli;delete-virtual-router.html"
                >delete-virtual-router</ulink>.</para>
        <note>
            <para>You cannot delete a virtual router if it has any <link linkend="routes"
                    >routes</link> or if it is specified as a provider for any <link
                    linkend="virtual_services">virtual service</link>.</para>
        </note>
        <procedure>
            <title>To delete a virtual router using the &console; </title>
            <step>
                <para>&MESHConsoleSwitch;</para>
            </step>
            <step>
                <para>Choose the mesh that you want to delete a virtual router from. All of the
                    meshes that you own and that have been <link linkend="sharing">shared</link>
                    with you are listed.</para>
            </step>
            <step>
                <para>Choose <guilabel>Virtual routers</guilabel> in the left navigation.</para>
            </step>
            <step>
                <para>In the <guilabel>Virtual Routers</guilabel> table, choose the virtual router
                    that you want to delete and select <guilabel>Delete</guilabel>. To delete a
                    virtual router, your account ID must be listed in either the <guilabel>Mesh
                        owner</guilabel> or the <guilabel>Resource owner</guilabel> columns of the
                    virtual router.</para>
            </step>
            <step>
                <para>In the confirmation box, type <userinput>delete</userinput> and then select
                        <guilabel>Delete</guilabel>.</para>
            </step>
        </procedure>
    </section>
    <xi:include href="routes.xml"/>
</section>
