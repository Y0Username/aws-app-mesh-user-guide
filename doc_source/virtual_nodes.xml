<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "file://zonbook/docbookx.dtd"
[
    <!ENTITY % xinclude SYSTEM "file://AWSShared/common/xinclude.mod">
    %xinclude;
    <!ENTITY % phrases-shared SYSTEM "file://AWSShared/common/phrases-shared.ent">
    %phrases-shared;
    <!ENTITY % phrases-appmesh SYSTEM "../shared/phrases-app-mesh.ent"> 
    %phrases-appmesh;
]>
<section role="topic" id="virtual_nodes">
    <info>
        <title id="virtual_nodes.title">Virtual nodes</title>
    </info>
    <para>A virtual node acts as a logical pointer to a particular task group, such as an &ECS;
        service or a Kubernetes deployment. When you create a virtual node, you must specify a
        service discovery method for your task group. Any inbound traffic that your virtual node
        expects is specified as a <emphasis role="italic">listener</emphasis>. Any virtual service
        that a virtual node sends outbound traffic to is specified as a <emphasis role="italic"
            >backend</emphasis>.</para>
    <para>The response metadata for your new virtual node contains the &ARNlong; that is associated
        with the virtual node. Set this value as the <code>APPMESH_RESOURCE_ARN</code> environment
        variable for your task group's Envoy proxy container in your &ECS; task definition or
        Kubernetes pod spec. For example, the value could be
                <code>arn:aws:appmesh:<replaceable>us-west-2</replaceable>:<replaceable>&ExampleAWSAccountNo1;</replaceable>:mesh/<replaceable>myMesh</replaceable>/virtualNode/<replaceable>myVirtualNode</replaceable></code>.
        This is then mapped to the <code>node.id</code> and <code>node.cluster</code> Envoy
        parameters. You must be using <code>1.15.0</code> or later of the Envoy image when setting
        this variable. For more information about &MESH; Envoy variables, see <xref linkend="envoy"
        />.</para>
    <note>
        <para>By default, &MESH; uses the name of the resource you specified in
                <code>APPMESH_RESOURCE_ARN</code> when Envoy is referring to itself in metrics and
            traces. You can override this behavior by setting the
                <code>APPMESH_RESOURCE_CLUSTER</code> environment variable with your own
            name.</para>
    </note>
    <section id="vn-create-virtual-node">
        <info>
            <title id="vn-create-virtual-node.title">Creating a virtual node</title>
        </info>
        <para> To create a virtual node using the &CLI; version &aws_cli_min_version; or higher, see
            the example in the &CLI; reference for the <ulink type="documentation"
                url="cli/latest/reference/appmesh/create-virtual-node.html"
                >create-virtual-node</ulink> command.</para>
        <procedure>
            <title>To create a virtual node using the &console;</title>
            <step>
                <para>&MESHConsoleSwitch;</para>
            </step>
            <step>
                <para>Choose the mesh that you want to create the virtual node in. All of the meshes
                    that you own and that have been <link linkend="sharing">shared</link> with you
                    are listed.</para>
            </step>
            <step>
                <para>Choose <guilabel>Virtual nodes</guilabel> in the left navigation.</para>
            </step>
            <step>
                <para>Choose <guilabel>Create virtual node</guilabel>.</para>
            </step>
            <step>
                <para>Specify settings for your virtual node.</para>
                <substeps>
                    <step>
                        <para><guilabel>Virtual node configuration</guilabel></para>
                        <itemizedlist>
                            <listitem>
                                <para>For <guilabel>Virtual node name</guilabel>, enter a name for
                                    your virtual node.</para>
                            </listitem>
                            <listitem>
                                <para>For <guilabel>Service discovery method</guilabel>, choose one
                                    of the following options:</para>
                                <itemizedlist>
                                    <listitem>
                                        <para><guilabel>DNS</guilabel> &endash; Specify the
                                                <guilabel>DNS hostname</guilabel> of the actual
                                            service that the virtual node represents. The Envoy
                                            proxy is deployed in an &VPC;. The proxy sends name
                                            resolution requests to the DNS server that is configured
                                            for the VPC. If the hostname resolves, the DNS server
                                            returns one or more IP addresses. For more information
                                            about VPC DNS settings, see <ulink type="documentation"
                                                url="vpc/latest/userguide/vpc-dns.html">Using DNS
                                                with your VPC</ulink>. If the DNS server returns
                                            multiple IP addresses, then the Envoy proxy chooses one
                                            of the addresses using the <ulink
                                                url="&url-envoy-user;intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-types-logical-dns"
                                                >Logical DNS</ulink> service discovery type.</para>
                                    </listitem>
                                    <listitem>
                                        <para><guilabel>&CMAP;</guilabel> &endash; Specify an
                                            existing <guilabel>Service name</guilabel> and
                                                <guilabel>Namespace</guilabel>. Optionally, you can
                                            also specify attributes that &MESH; can query &CMAP; for
                                            by selecting <guilabel>Add row</guilabel> and specifying
                                            a <guilabel>Key</guilabel> and
                                                <guilabel>Value</guilabel>. Only instances that
                                            match all of the specified key/value pairs will be
                                            returned. To use &CMAP;, your account must have the
                                                <code>AWSServiceRoleForAppMesh</code>
                                            <link linkend="using-service-linked-roles"
                                                >service-linked role</link>. For more information
                                            about &CMAP;, see the &link-cmap-dg;.</para>
                                    </listitem>
                                    <listitem>
                                        <para><guilabel>None</guilabel> &endash; Select if your
                                            virtual node doesn't expect any inbound traffic.</para>
                                    </listitem>

                                </itemizedlist>
                            </listitem>
                            <listitem minimized="true">
                                <para>(Optional) <guilabel>Client policy defaults</guilabel>
                                    &endash; Configure default requirements when communicating to
                                    backend virtual services.</para>
                                <note>
                                    <itemizedlist>
                                        <listitem>
                                            <para>If you want to enable Transport Layer Security
                                                (TLS) for an existing virtual node, then we
                                                recommend that you create a new virtual node, which
                                                represents the same service as the existing virtual
                                                node, on which to enable TLS. Then gradually shift
                                                traffic to the new virtual node using a virtual
                                                router and route. For more information about
                                                creating a route and adjusting weights for the
                                                transition, see <link linkend="routes"
                                                  endterm="routes.title"/>. If you update an
                                                existing, traffic-serving virtual node with TLS,
                                                there is a chance that the downstream client Envoy
                                                proxies will receive TLS validation context before
                                                the Envoy proxy for the virtual node that you have
                                                updated receives the certificate. This can cause TLS
                                                negotiation errors on the downstream Envoy
                                                proxies.</para>
                                        </listitem>
                                        <listitem>
                                            <para><link linkend="proxy-authorization">Proxy
                                                  authorization</link> must be enabled for the Envoy
                                                proxy deployed with the application represented by
                                                the backend service's virtual nodes. We recommend
                                                that when you enable proxy authorization, you
                                                restrict access to only the virtual nodes that this
                                                virtual node is communicating with.</para>
                                        </listitem>
                                    </itemizedlist>
                                </note>
                                <itemizedlist>
                                    <listitem>
                                        <para>(Optional) Select <guilabel>Enforce TLS</guilabel> if
                                            you want to require the virtual node to communicate with
                                            all backends using Transport Layer Security
                                            (TLS).</para>
                                    </listitem>
                                    <listitem>
                                        <para>(Optional) If you only want to require the use of TLS
                                            for one or more specific ports, then enter a number in
                                                <guilabel>Ports</guilabel>. To add additional ports,
                                            select <guilabel>Add port</guilabel>. If you don't
                                            specify any ports, TLS is enforced for all ports.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Validation method</guilabel>, select one
                                            of the following options. The certificate that you
                                            specify must already exist and meet specific
                                            requirements. For more information, see <xref
                                                linkend="virtual-node-tls-prerequisites"
                                                endterm="virtual-node-tls-prerequisites.title"
                                            />.</para>
                                        <itemizedlist>
                                            <listitem>
                                                <para><emphasis role="bold">&PCAlong;</emphasis>
                                                  hosting &endash; Select one or more existing
                                                  <guilabel>Certificates</guilabel>. For a complete,
                                                  end-to-end walk through of deploying a mesh with a
                                                  sample application using encryption with an &ACM;
                                                  certificate, see <ulink
                                                  url="https://github.com/aws/aws-app-mesh-examples/tree/master/walkthroughs/tls-with-acm"
                                                  >Configuring TLS with &AWS; Certificate
                                                  Manager</ulink> on GitHub.</para>
                                            </listitem>
                                            <listitem>
                                                <para><emphasis role="bold">Envoy Secret Discovery
                                                  Service (SDS)</emphasis> hosting &endash; Enter
                                                  the name of the secret Envoy will fetch using the
                                                  Secret Discovery Service.</para>
                                            </listitem>
                                            <listitem>
                                                <para><emphasis role="bold">Local file
                                                  hosting</emphasis> &endash; Specify the path to
                                                  the <guilabel>Certificate chain</guilabel> file on
                                                  the file system where Envoy is deployed. For a
                                                  complete, end-to-end walk through of deploying a
                                                  mesh with a sample application using encryption
                                                  with local files, see <ulink
                                                  url="https://github.com/aws/aws-app-mesh-examples/tree/master/walkthroughs/howto-tls-file-provided"
                                                  >Configuring TLS with File Provided TLS
                                                  Certificates</ulink> on GitHub.</para>
                                            </listitem>
                                        </itemizedlist>
                                    </listitem>
                                    <listitem>
                                        <para>(Optional) Enter a <guilabel>Subject Alternative
                                                Name</guilabel>. To add additional SANs, select
                                                <guilabel>Add SAN</guilabel>. SANs must be FQDN or
                                            URI formatted.</para>
                                    </listitem>
                                    <listitem>
                                        <para>(Optional) Select <emphasis role="bold">Provide client
                                                certificate</emphasis> and one of the options below
                                            to provide a client certificate when a server requests
                                            it and enable mutual TLS authentication . To learn more
                                            about mutual TLS, see the &MESH; <ulink
                                                url="https://docs.aws.amazon.com/app-mesh/latest/userguide/mutual-tls.html"
                                                >Mutual TLS Authentication</ulink> docs.</para>
                                        <itemizedlist>
                                            <listitem>
                                                <para><emphasis role="bold">Envoy Secret Discovery
                                                  Service (SDS)</emphasis> hosting &endash; Enter
                                                  the name of the secret Envoy will fetch using the
                                                  Secret Discovery Service.</para>
                                            </listitem>
                                            <listitem>
                                                <para><emphasis role="bold">Local file
                                                  hosting</emphasis> &endash; Specify the path to
                                                  the <guilabel>Certificate chain</guilabel> file,
                                                  as well as the <guilabel>Private key</guilabel>,
                                                  on the file system where Envoy is deployed.</para>
                                            </listitem>
                                        </itemizedlist>
                                    </listitem>
                                </itemizedlist>
                            </listitem>
                            <listitem minimized="true">
                                <para>(Optional) <guilabel>Service backends</guilabel> &endash;
                                    Specify the &MESH; virtual service that the virtual node will
                                    communicate with.</para>
                                <itemizedlist>
                                    <listitem>
                                        <para>Enter an &MESH; virtual service name or full &ARNlong;
                                            for the virtual service that your virtual node
                                            communicates with.</para>
                                    </listitem>
                                    <listitem>
                                        <para>(Optional) If you want to set unique TLS settings for
                                            a backend, select <guilabel>TLS settings</guilabel> and
                                            then select <guilabel>Override
                                            defaults</guilabel>.</para>
                                        <itemizedlist>
                                            <listitem>
                                                <para>(Optional) Select <guilabel>Enforce
                                                  TLS</guilabel> if you want to require the virtual
                                                  node to communicate with all backends using
                                                  TLS.</para>
                                            </listitem>
                                            <listitem>
                                                <para>(Optional) If you only want to require the use
                                                  of TLS for one or more specific ports, then enter
                                                  a number in <guilabel>Ports</guilabel>. To add
                                                  additional ports, select <guilabel>Add
                                                  port</guilabel>. If you don't specify any ports,
                                                  TLS is enforced for all ports.</para>
                                            </listitem>
                                            <listitem>
                                                <para>For <guilabel>Validation method</guilabel>,
                                                  select one of the following options. The
                                                  certificate that you specify must already exist
                                                  and meet specific requirements. For more
                                                  information, see <xref
                                                  linkend="virtual-node-tls-prerequisites"
                                                  endterm="virtual-node-tls-prerequisites.title"
                                                  />.</para>
                                                <itemizedlist>
                                                  <listitem>
                                                  <para><emphasis role="bold">&PCAlong;</emphasis>
                                                  hosting &endash; Select one or more existing
                                                  <guilabel>Certificates</guilabel>.</para>
                                                  </listitem>
                                                  <listitem>
                                                  <para><emphasis role="bold">Envoy Secret Discovery
                                                  Service (SDS)</emphasis> hosting &endash; Enter
                                                  the name of the secret Envoy will fetch using the
                                                  Secret Discovery Service.</para>
                                                  </listitem>
                                                  <listitem>
                                                  <para><emphasis role="bold">Local file
                                                  hosting</emphasis> &endash; Specify the path to
                                                  the <guilabel>Certificate chain</guilabel> file on
                                                  the file system where Envoy is deployed.</para>
                                                  </listitem>
                                                </itemizedlist>
                                            </listitem>
                                            <listitem>
                                                <para>(Optional) Enter a <guilabel>Subject
                                                  Alternative Name</guilabel>. To add additional
                                                  SANs, select <guilabel>Add SAN</guilabel>. SANs
                                                  must be FQDN or URI formatted.</para>
                                            </listitem>
                                            <listitem>
                                                <para>(Optional) Select <emphasis role="bold"
                                                  >Provide client certificate</emphasis> and one of
                                                  the options below to provide a client certificate
                                                  when a server requests it and enable mutual TLS
                                                  authentication. To learn more about mutual TLS,
                                                  see the &MESH; <ulink
                                                  url="https://docs.aws.amazon.com/app-mesh/latest/userguide/mutual-tls.html"
                                                  >Mutual TLS Authentication</ulink> docs.</para>
                                                <itemizedlist>
                                                  <listitem>
                                                  <para><emphasis role="bold">Envoy Secret Discovery
                                                  Service (SDS)</emphasis> hosting &endash; Enter
                                                  the name of the secret Envoy will fetch using the
                                                  Secret Discovery Service.</para>
                                                  </listitem>
                                                  <listitem>
                                                  <para><emphasis role="bold">Local file
                                                  hosting</emphasis> &endash; Specify the path to
                                                  the <guilabel>Certificate chain</guilabel> file,
                                                  as well as the <guilabel>Private key</guilabel>,
                                                  on the file system where Envoy is deployed.</para>
                                                  </listitem>
                                                </itemizedlist>
                                            </listitem>
                                        </itemizedlist>
                                    </listitem>
                                </itemizedlist>
                                <para>To add additional backends, select <guilabel>Add
                                        backend</guilabel>.</para>
                            </listitem>
                            <listitem minimized="true">
                                <para>(Optional) <guilabel>Logging</guilabel></para>
                                <para>To configure logging, enter the HTTP access logs path that you
                                    want Envoy to use. We recommend the
                                        <filename>/dev/stdout</filename> path so that you can use
                                    Docker log drivers to export your Envoy logs to a service such
                                    as &CWLlong;.</para>
                                <note>
                                    <para>Logs must still be ingested by an agent in your
                                        application and sent to a destination. This file path only
                                        instructs Envoy where to send the logs. </para>
                                </note>
                            </listitem>
                        </itemizedlist>
                    </step>
                    <step>
                        <para><guilabel>Listener configuration</guilabel></para>
                        <itemizedlist>
                            <listitem>
                                <para>If your virtual node expects inbound traffic, specify a
                                        <guilabel>Port</guilabel> and <guilabel>Protocol</guilabel>
                                    for the <guilabel>Listener</guilabel>. The
                                        <guilabel>http</guilabel> listener permits connection
                                    transition to websockets.</para>
                            </listitem>
                            <listitem minimized="true">
                                <para>(Optional) <guilabel>Enable connection pool</guilabel>
                                </para>
                                <para>Connection pooling limits the number of connections that an
                                    Envoy can concurrently establish with all the hosts in the
                                    upstream cluster. It is intended to protect your local
                                    application from being overwhelmed with connections and lets you
                                    adjust traffic shaping for the needs of your
                                    applications.</para>
                                <para>You can configure destination-side connection pool settings
                                    for a virtual node listener. &MESH; sets the client-side
                                    connection pool settings to infinite by default, simplifying
                                    mesh configuration.</para>
                                <note>
                                    <para>The connectionPool and portMapping protocols must be the
                                        same. If your listener protocol is tcp, specify
                                        maxConnections only. If your listener protocol is grpc or
                                        http2, specify maxRequests only. If your listener protocol
                                        is http, you can specify both maxConnections and
                                        maxPendingRequests. </para>
                                </note>
                                <itemizedlist>
                                    <listitem>
                                        <para>For <guilabel>Maximum connections</guilabel>, specify
                                            the maximum number of outbound connections.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Maximum requests</guilabel>, specify
                                            maximum number of parallel requests that can occur to
                                            the upstream cluster.</para>
                                    </listitem>
                                    <listitem>
                                        <para>(Optional) For <guilabel>Maximum pending
                                                requests</guilabel>, specify the number of
                                            overflowing requests after <guilabel>Maximum
                                                connections</guilabel> that an Envoy will queue. The
                                            default value is <code>2147483647</code>.</para>
                                    </listitem>
                                </itemizedlist>
                            </listitem>
                            <listitem minimized="true">
                                <para>(Optional) <guilabel>Enable outlier detection
                                    </guilabel></para>
                                <para>Outlier detection applied at the client Envoy allows clients
                                    to take near-immediate action on connections with observed known
                                    bad failures. It is a form of a circuit breaker implementation
                                    that tracks the health status of individual hosts in the
                                    upstream service.</para>
                                <para>Outlier detection dynamically determines whether endpoints in
                                    an upstream cluster are performing unlike the others and removes
                                    them from the healthy load balancing set.</para>
                                <note>
                                    <para>To effectively configure outlier detection for a server
                                        Virtual Node, the service discovery method of that Virtual
                                        Node should use &CMAP;. Otherwise if using DNS, the Envoy
                                        proxy would only elect a single IP address for routing to
                                        the upstream service, nullifying the outlier detection
                                        behavior of ejecting an unhealthy host from a set of hosts.
                                        Refer to the Service discovery method section for more
                                        details on the Envoy proxy's behavior in relation to the
                                        service discovery type. </para>
                                </note>
                                <itemizedlist>
                                    <listitem>
                                        <para>For <guilabel>Server errors</guilabel>, specify the
                                            number of consecutive 5xx errors required for
                                            ejection.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Outlier detection interval</guilabel>,
                                            specify the time interval and unit between ejection
                                            sweep analysis.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Base ejection duration</guilabel>,
                                            specify the base amount of time and unit for which a
                                            host is ejected.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Ejection percentage</guilabel>, specify
                                            the maximum percentage of hosts in the load balancing
                                            pool that can be ejected.</para>
                                    </listitem>
                                </itemizedlist>
                            </listitem>
                            <listitem minimized="true">
                                <para>(Optional) <guilabel>Enable health check</guilabel> &endash;
                                    Configure settings for a health check policy.</para>
                                <para>A health check policy is optional, but if you specify any
                                    values for a health policy, then you must specify values for
                                        <guilabel>Healthy threshold</guilabel>, <guilabel>Health
                                        check interval</guilabel>, <guilabel>Health check
                                        protocol</guilabel>, <guilabel>Timeout period</guilabel>,
                                    and <guilabel>Unhealthy threshold</guilabel>.</para>
                                <itemizedlist>
                                    <listitem>
                                        <para>For <guilabel>Health check protocol</guilabel>, choose
                                            a protocol. If you select <guilabel>grpc</guilabel>,
                                            then your service must conform to the <ulink
                                                url="https://github.com/grpc/grpc/blob/master/doc/health-checking.md"
                                                >GRPC Health Checking Protocol</ulink>.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Health check port</guilabel>, specify
                                            the port that the health check should run on.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Healthy threshold</guilabel>, specify
                                            the number of consecutive successful health checks that
                                            must occur before declaring the listener healthy.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Health check interval</guilabel>,
                                            specify the time period in milliseconds between each
                                            health check execution.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Path</guilabel>, specify the destination
                                            path for the health check request. This value is only
                                            used if the <guilabel>Health check protocol</guilabel>
                                            is <code>http</code> or <code>http2</code>. The value is
                                            ignored for other protocols.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Timeout period</guilabel>, specify the
                                            amount of time to wait when receiving a response from
                                            the health check, in milliseconds.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Unhealthy threshold</guilabel>, specify
                                            the number of consecutive failed health checks that must
                                            occur before declaring the listener unhealthy.</para>
                                    </listitem>
                                </itemizedlist>
                            </listitem>
                            <listitem minimized="true">
                                <para>(Optional) <guilabel>Enable TLS termination</guilabel>
                                    &endash; Configure how other virtual nodes communicate with this
                                    virtual node using TLS.</para>
                                <itemizedlist>
                                    <listitem>
                                        <para>For <guilabel>Mode</guilabel>, select the mode you
                                            want TLS to be configured for on the listener.</para>
                                    </listitem>
                                    <listitem>
                                        <para>For <guilabel>Certificate method</guilabel>, select
                                            one of the following options. The certificate must meet
                                            specific requirements. For more information, see <xref
                                                linkend="virtual-node-tls-prerequisites"
                                                endterm="virtual-node-tls-prerequisites.title"
                                            />.</para>
                                        <itemizedlist>
                                            <listitem>
                                                <para><guilabel>&ACMlong; hosting</guilabel>
                                                  &endash; Select an existing
                                                  <guilabel>Certificate</guilabel>.</para>
                                            </listitem>
                                            <listitem>
                                                <para><emphasis role="bold">Envoy Secret Discovery
                                                  Service (SDS)</emphasis> hosting &endash; Enter
                                                  the name of the secret Envoy will fetch using the
                                                  Secret Discovery Service.</para>
                                            </listitem>
                                            <listitem>
                                                <para><emphasis role="bold">Local file
                                                  hosting</emphasis> &endash; Specify the path to
                                                  the <guilabel>Certificate chain</guilabel> file,
                                                  as well as the <guilabel>Private key</guilabel>,
                                                  on the file system where the Envoy proxy is
                                                  deployed.</para>
                                            </listitem>
                                        </itemizedlist>
                                    </listitem>
                                    <listitem>
                                        <para>(Optional) Select <emphasis role="bold">Require client
                                                certificates</emphasis> and one of the options below
                                            to enable mutual TLS authentication when a client
                                            provides a certificate. To learn more about mutual TLS,
                                            see the &MESH; <ulink
                                                url="https://docs.aws.amazon.com/app-mesh/latest/userguide/mutual-tls.html"
                                                >Mutual TLS Authentication</ulink> docs.</para>
                                        <itemizedlist>
                                            <listitem>
                                                <para><emphasis role="bold">Envoy Secret Discovery
                                                  Service (SDS)</emphasis> hosting &endash; Enter
                                                  the name of the secret Envoy will fetch using the
                                                  Secret Discovery Service.</para>
                                            </listitem>
                                            <listitem>
                                                <para><emphasis role="bold">Local file
                                                  hosting</emphasis> &endash; Specify the path to
                                                  the <guilabel>Certificate chain</guilabel> file on
                                                  the file system where Envoy is deployed.</para>
                                            </listitem>
                                        </itemizedlist>
                                    </listitem>
                                    <listitem>
                                        <para>(Optional) Enter a <guilabel>Subject Alternative
                                                Name</guilabel>. To add additional SANs, select
                                                <guilabel>Add SAN</guilabel>. SANs must be FQDN or
                                            URI formatted.</para>
                                    </listitem>
                                </itemizedlist>
                            </listitem>
                            <listitem minimized="true">
                                <para>(Optional) <guilabel>Timeouts</guilabel>.</para>
                                <itemizedlist>
                                    <listitem>
                                        <para><guilabel>Request timeout</guilabel> &endash; You can
                                            specify a request timeout if you selected
                                                <guilabel>grpc</guilabel>,
                                            <guilabel>http</guilabel>, or <guilabel>http2</guilabel>
                                            for the listener's <guilabel>Protocol</guilabel>. The
                                            default is 15 seconds. A value of <code>0</code> disables the timeout.</para>
                                    </listitem>
                                    <listitem>
                                        <para><guilabel>Idle duration</guilabel> &endash; You can
                                            specify an idle duration for any listener protocol. The
                                            default is 300 seconds.</para>
                                    </listitem>
                                </itemizedlist>
                                <note>
                                    <para> If you specify a timeout greater than the default, make
                                        sure to set up a virtual router and a route with a timeout
                                        greater than the default. However, if you decrease the
                                        timeout to a value that is lower than the default, it's
                                        optional to update the timeouts at Route. For more
                                        information, see <ulink
                                            url="https://docs.aws.amazon.com/app-mesh/latest/userguide/routes.html"
                                            >Routes</ulink>.</para>
                                </note>
                            </listitem>
                        </itemizedlist>
                    </step>
                </substeps>
            </step>
            <step>
                <para>Choose <guilabel>Create virtual node</guilabel> to finish.</para>
            </step>
        </procedure>
    </section>
    <section id="delete-virtual-node">
        <info>
            <title id="delete-virtual-node.title">Deleting a virtual node</title>
        </info>
        <para>To delete a virtual node using the &CLI;, use the <code>aws appmesh
                delete-virtual-node</code> command. For an example of deleting a virtual node using
            the &CLI;, see <ulink type="documentation"
                url="cli/latest/reference/appmesh/delete-virtual-node.html"
                >delete-virtual-node</ulink>.</para>
        <note>
            <para>You can't delete a virtual node if it is specified as a target in any <link
                    linkend="routes">route</link> or as a provider in any <link
                    linkend="virtual_services">virtual service</link>.</para>
        </note>
        <procedure>
            <title>To delete a virtual node using the &console;</title>
            <step>
                <para>&MESHConsoleSwitch;</para>
            </step>
            <step>
                <para>Choose the mesh that you want to delete a virtual node from. All of the meshes
                    that you own and that have been <link linkend="sharing">shared</link> with you
                    are listed.</para>
            </step>
            <step>
                <para>Choose <guilabel>Virtual nodes</guilabel> in the left navigation.</para>
            </step>
            <step>
                <para>In the <guilabel>Virtual Nodes</guilabel> table, choose the virtual node that
                    you want to delete and select <guilabel>Delete</guilabel>. To delete a virtual
                    node, your account ID must be listed in either the <guilabel>Mesh
                        owner</guilabel> or the <guilabel>Resource owner</guilabel> columns of the
                    virtual node.</para>
            </step>
            <step>
                <para>In the confirmation box, type <userinput>delete</userinput> and then select
                        <guilabel>Delete</guilabel>.</para>
            </step>
        </procedure>
    </section>
</section>
