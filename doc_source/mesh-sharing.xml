<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "file://zonbook/docbookx.dtd"
[
<!ENTITY % xinclude SYSTEM "file://AWSShared/common/xinclude.mod">
%xinclude;
<!ENTITY % phrases-shared SYSTEM "file://AWSShared/common/phrases-shared.ent">
%phrases-shared;
<!ENTITY % phrases-appmesh SYSTEM "../shared/phrases-app-mesh.ent"> 
    %phrases-appmesh;
<!ENTITY RESOURCE "mesh">
<!ENTITY SERVICE "&MESH;">
]>

<!--GUIDELINES
1. Enter your resource name and service name in the entities above.
2. Read the comments carefully. Feel free to remove comments after you have addressed them.
3. "owner" = the account that owns the resource and shares it. "consumer" = the account with which the resource is shared.
4. Add in any additional sections that might be specific to your service.
5. After you have completed your topic, do a text search for "TBD" to ensure that you haven't missed anything.
6. For examples, see https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/capacity-reservation-sharing.html AND https://docs.aws.amazon.com/vpc/latest/userguide/vpc-sharing.html-->

<chapter role="topic" id="sharing">
	<info>
		<title id="sharing.title">Working with shared meshes</title>
		<abstract>
			<para>Working with shared &RESOURCE;es.</para>
		</abstract>
	</info>
	<para>A shared mesh allows resources created by different accounts to communicate with each
		other in the same mesh.</para>

	<para>An &IAMlong; account can be a mesh resource owner, a mesh consumer, or both. Consumers can
		create resources in a mesh that is shared with their account. Owners can create resources in
		any mesh the account owns. A &RESOURCE; owner can share a &RESOURCE; with the following
		types of mesh consumers:</para>
	<itemizedlist>
		<listitem>
			<para>Specific &AWS; accounts inside or outside of its organization in &AOlong;</para>
		</listitem>
		<listitem>
			<para>An organizational unit inside its organization in &AOlong;</para>
		</listitem>
		<listitem>
			<para>Its entire organization in &AOlong;</para>
		</listitem>
	</itemizedlist>
	<para>For an end-to-end walk through of sharing a mesh, see <ulink
			url="https://github.com/aws/aws-app-mesh-examples/tree/master/walkthroughs/howto-cross-account"
			>Cross-account mesh walk through</ulink> on GitHub.</para>
	<section id="sharing-permissions">
		<info>
			<title id="sharing-permissions.title">Shared mesh permissions</title>
		</info>
		<para>A shared mesh has the following permissions:</para>
		<itemizedlist>
			<listitem>
				<para>Consumers can list and describe all resources in a mesh that is shared with
					the account.</para>
			</listitem>
			<listitem>
				<para>Owners can list and describe all resources in any mesh the account
					owns.</para>
			</listitem>
			<listitem>
				<para>Owners and consumers can modify resources in a mesh that the account created,
					but they cannot modify resources that other another account created.</para>
			</listitem>
			<listitem>
				<para>Consumers can delete any resource in a mesh that the account created.</para>
			</listitem>
			<listitem>
				<para>Owners can delete any resource in a mesh that any account created.</para>
			</listitem>
			<listitem>
				<para>Owner's resources can only reference other resources in the same account. For
					example, a virtual node can only reference &CMAP; or an &ACMlong; certificate
					that is in the same account as the virtual node's owner.</para>
			</listitem>
			<listitem>
				<para>Owners and consumers can connect an Envoy proxy to &MESH; as a virtual node
					that the account owns.</para>
			</listitem>
			<listitem>
				<para>Owners can create virtual gateways and virtual gateway routes.</para>
			</listitem>
		</itemizedlist>
	</section>


	<section id="sharing-prereqs">
		<info>
			<title id="sharing-prereq.titles">Prerequisites for sharing meshes</title>
		</info>
		<para>The following prerequisites must be met in order to share a &RESOURCE;:</para>
		<itemizedlist>
			<listitem>
				<para>You must own the mesh in your &AWS; account. You cannot share a &RESOURCE;
					that has been shared with you.</para>
			</listitem>
			<listitem>
				<para>To share a &RESOURCE; with your organization or an organizational unit in
					&AOlong;, you must enable sharing with &AOlong;. For more information, see
						<ulink type="documentation"
						url="ram/latest/userguide/getting-started-sharing.html#getting-started-sharing-orgs"
						> Enable Sharing with &AOlong;</ulink> in the
						<emphasis>&guide-ram-ug;</emphasis>.</para>
			</listitem>
			<listitem>
				<para>Your services must be deployed in an &VPC; that has shared connectivity across
					the accounts that include the mesh resources that you want to communicate with
					each other. One way to share network connectivity is to deploy all of the
					services that you want to use in your mesh to a shared subnet. For more
					information and limitations, see <ulink type="documentation"
						url="vpc/latest/userguide/vpc-sharing.html#vpc-sharing-share-subnet">Sharing
						a Subnet</ulink>.</para>
			</listitem>
			<listitem>
				<para>Services must be discoverable through DNS or &CMAP;. For more information
					about service discovery, see <link linkend="virtual_nodes">Virtual
					nodes</link>.</para>
			</listitem>
		</itemizedlist>
	</section>
	<section id="sharing-related">
		<info>
			<title id="sharing-related.title">Related services</title>
		</info>
		<!--Do not update this content. This applies to all shareable resources.-->
		<para>&RESOURCE; sharing integrates with &RAMlong; (&RAM;). &RAM; is a service that enables
			you to share your &AWS; resources with any &AWS; account or through &AOlong;. With
			&RAM;, you share resources that you own by creating a <emphasis>resource
				share</emphasis>. A resource share specifies the resources to share, and the
			consumers with whom to share them. Consumers can be individual &AWS; accounts, or
			organizational units or an entire organization in &AOlong;.</para>
		<para>For more information about &RAM;, see the <emphasis>&link-ram-ug;</emphasis>.</para>
	</section>
	<section id="sharing-share">
		<info>
			<title id="sharing-share.title">Sharing a mesh</title>
		</info>
		<para>Sharing a mesh enables mesh resources created by different accounts to communicate
			with each other in the same mesh. You can only share a mesh that you own. To share a
			&RESOURCE;, you must add it to a resource share. A resource share is an &RAM; resource
			that lets you share your resources across &AWS; accounts. A resource share specifies the
			resources to share, and the consumers with whom they are shared. When you share a
			&RESOURCE; using the &SERVICE; console, you add it to an existing resource share. To add
			the &RESOURCE; to a new resource share, you must first create the resource share using
			the <ulink type="console" url="ram">&RAM; console</ulink>.</para>

		<!--The following paragraph is true for all resources that support sharing within &AWS; Orgs.-->
		<para>If you are part of an organization in &AOlong; and sharing within your organization is
			enabled, consumers in your organization can be automatically granted access to the
			shared &RESOURCE;. Otherwise, consumers receive an invitation to join the resource share
			and are granted access to the shared &RESOURCE; after accepting the invitation.</para>

		<para>You can share a &RESOURCE; that you own using the &RAM; console or the &CLI;.</para>
		<!--Leave as is.-->
		<formalpara>
			<title>To share a &RESOURCE; that you own using the &RAM; console</title>
			<para>See <ulink type="documentation"
					url="/ram/latest/userguide/working-with-sharing.html#working-with-sharing-create"
					>Creating a Resource Share</ulink> in the <emphasis>&guide-ram-ug;</emphasis>.
				When selecting a resource type, select <guilabel>Meshes</guilabel>, and then select
				the mesh you want to share. If no meshes are listed, then you need to create a mesh
				first. For more information, see <link linkend="create-mesh"
					endterm="create-mesh.title"/>.</para>
		</formalpara>
		<!--Leave as is.-->
		<formalpara>
			<title>To share a &RESOURCE; that you own using the &CLI;</title>
			<para>Use the <ulink type="documentation"
					url="cli/latest/reference/ram/create-resource-share.html"
					>create-resource-share</ulink> command. For the <code>--resource-arns</code>
				option, specify the ARN of the mesh that you want to share.</para>
		</formalpara>
	</section>


	<section id="sharing-unshare">
		<info>
			<title id="sharing-unshare.title">Unsharing a shared &RESOURCE;</title>
		</info>
		<!--Explain what happens (for the owner and cosumers) when your resource is unshared.-->
		<para>When you unshare a mesh, &MESH; disables further access to the mesh by former
			consumers of the mesh but does not delete the resources created by the consumers. Once
			the mesh is unshared, only the mesh owner can access and delete the resources. &MESH;
			prevents the account that owned resources in the mesh, and any other accounts with
			resources in the mesh, from receiving any configuration information after the mesh is
			unshared. Only the owner of the mesh can unshare it.</para>
		<para>To unshare a shared &RESOURCE; that you own, you must remove it from the resource
			share. You can do this using the &RAM; console or the &CLI;.</para>

		<formalpara>
			<title>To unshare a shared &RESOURCE; that you own using the &RAM; console</title>
			<para>See <ulink type="documentation"
					url="ram/latest/userguide/working-with-sharing.html#working-with-sharing-update"
					>Updating a Resource Share</ulink> in the <emphasis role="italic"
					>&guide-ram-ug;</emphasis>.</para>
		</formalpara>

		<!--Leave as is.-->
		<formalpara>
			<title>To unshare a shared &RESOURCE; that you own using the &CLI;</title>
			<para>Use the <ulink type="documentation"
					url="cli/latest/reference/ram/disassociate-resource-share.html"
					>disassociate-resource-share</ulink> command.</para>
		</formalpara>
	</section>


	<section id="sharing-identify">
		<info>
			<title id="sharing-identify.title">Identifying a shared &RESOURCE;</title>
		</info>
		<para>Owners and consumers can identify shared &RESOURCE;es and mesh resources using the
			&SERVICE; console and &CLI;</para>

		<!--Add your console prcedure here-->
		<procedure>
			<title>To identify a shared &RESOURCE; using the &SERVICE; console</title>
			<step>
				<para>&MESHConsoleSwitch;</para>
			</step>
			<step>
				<para>From the left navigation, select <guilabel>Meshes</guilabel>. The account ID
					of the mesh owner for each mesh is listed in the <guilabel>Mesh owner</guilabel>
					column.</para>
			</step>
			<step>
				<para>From the left navigation, select <guilabel>Virtual services</guilabel>,
						<guilabel>Virtual routers</guilabel>, or <guilabel>Virtual nodes</guilabel>.
					You see the account ID for the <guilabel>Mesh owner</guilabel> and
						<guilabel>Resource owner</guilabel> for each of the resources.</para>
			</step>
		</procedure>
		<formalpara>
			<title>To identify a shared &RESOURCE; using the &CLI;</title>
			<para>Use the <code>aws appmesh list <replaceable>resource</replaceable></code> command,
				such as <code>aws appmesh <ulink type="documentation"
						url="cli/latest/reference/appmesh/list-meshes.html"
					>list-meshes</ulink></code>. The command returns the meshes that you own and the
				meshes that are shared with you. The <code>meshOwner</code> property shows the &AWS;
				account ID of the <code>meshOwner</code> and the <code>resourceOwner</code> property
				shows the &AWS; account ID of the resource owner. Any command run against any mesh
				resource returns these properties.</para>
		</formalpara>
	</section>
	<section id="sharing-billing">
		<info>
			<title id="sharing-billing.title">Billing and metering</title>
		</info>
		<para>There are no charges for sharing a mesh.</para>
	</section>
	<section id="sharing-limits">
		<info>
			<title id="sharing-limits.title">Instance quotas</title>
		</info>
		<para>All quotas for a mesh also apply to shared meshes, regardless of who created resources
			in the mesh. Only a mesh owner can request quota increases. For more information, see
				<link linkend="service-quotas" endterm="service-quotas.title"/>. The &RAMlong;
			service also has quotas. For more information, see <ulink type="documentation"
				url="ram/latest/userguide/what-is.html#what-is-limits">Service
			Quotas</ulink>.</para>
	</section>
</chapter>
